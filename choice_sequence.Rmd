---
title: "botex_choices"
author: "Aamir Sohail"
date: "2025-04-18"
output: html_document
---

```{r}
# Install packages only if they are not already installed
required_packages <- c("ggplot2", "tidyverse", "readr", "here")
install_if_missing <- required_packages[!required_packages %in% installed.packages()]
if (length(install_if_missing) > 0) {
  install.packages(install_if_missing, quietly = TRUE)
}

# Load required libraries
library(tidyverse)
library(ggplot2)
library(readr)
library(here)
```

```{r}
# Read data
data <- read_csv(here("data", "otree", "otree_prolific_merged_filtered_2025-23-03.csv"))

# Helper to identify valid trials
data <- data %>%
  mutate(
    valid_trial1 = player.computer_choice_one != 1,
    valid_trial2 = player.computer_choice_two != 1
  )

# Compute majority selections, ignoring invalid trials
summary_data <- data %>%
  group_by(subsession.round_number) %>%
  summarise(
    chosen_one_1 = sum(player.chosen_image_one_binary == 1 & valid_trial1, na.rm = TRUE),
    chosen_one_2 = sum(player.chosen_image_one_binary == 2 & valid_trial1, na.rm = TRUE),
    chosen_two_1 = sum(player.chosen_image_two_binary == 1 & valid_trial2, na.rm = TRUE),
    chosen_two_2 = sum(player.chosen_image_two_binary == 2 & valid_trial2, na.rm = TRUE),
    total_one = chosen_one_1 + chosen_one_2,
    total_two = chosen_two_1 + chosen_two_2,
    chosen_one_majority = ifelse(chosen_one_1 >= chosen_one_2, 1, 2),
    chosen_two_majority = ifelse(chosen_two_1 >= chosen_two_2, 1, 2),
    chosen_one_detail = ifelse(total_one > 0,
                               paste0(chosen_one_1, "/", total_one, " (", round(chosen_one_1 / total_one * 100), "%)"),
                               "0/0 (NA%)"),
    chosen_two_detail = ifelse(total_two > 0,
                               paste0(chosen_two_1, "/", total_two, " (", round(chosen_two_1 / total_two * 100), "%)"),
                               "0/0 (NA%)")
  ) %>%
  arrange(subsession.round_number)

# Generate sequences
chosen_one_seq <- paste(summary_data$chosen_one_majority, collapse = " ")
chosen_two_seq <- paste(summary_data$chosen_two_majority, collapse = " ")

# Output file lines
output_lines <- c(
  chosen_one_seq,
  chosen_two_seq,
  "",
  "Image One Details:",
  paste0("Round ", summary_data$subsession.round_number, ": ", summary_data$chosen_one_detail),
  "",
  "Image Two Details:",
  paste0("Round ", summary_data$subsession.round_number, ": ", summary_data$chosen_two_detail)
)

# Write to file
writeLines(output_lines, here("image_choice_summary.txt"))
```

